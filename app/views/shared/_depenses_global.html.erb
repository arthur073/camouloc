    <div class="col-md-6">
            <div class="box box-primary">
                    <div class="box-header with-border">
                      <h3 class="box-title">Latest expenses</h3>
                      <div class="box-tools pull-right">
                        <span class="label label-primary"><%= @expenses.count %> expenses in total</span>
                      </div>
                    </div><!-- /.box-header -->
                    <div class="box-body">
                      <div class="table-responsive">
                        <table class="table no-margin">
                          <thead>
                            <tr>
                              <th>Author</th>
                              <th>Reason</th>
                              <th>Roommates involved</th>
                              <th>Value</th>
                            </tr>
                          </thead>
                          <tbody>
                            <% @expenses.each do |e| %>
                            <tr>
                              <td><%= link_to User.find(e.user_id).nom, User.find(e.user_id) %></td>
                              <td><%= e.raison %></td>                              
                              <td><%= e.roommates_involved %></td>
                              <td><%= number_to_currency(e.montant) %></td>
                            </tr>
                            <% end %>
                          </tbody>
                        </table>
                      </div><!-- /.table-responsive -->
                    </div><!-- /.box-body -->
                    <div class="box-footer clearfix">
                    </div><!-- /.box-footer -->
		  </div>
	</div>
  </div>
</section>


<%= javascript_include_tag "jquery.caret.min", "jquery.atwho.min" %>
<%= @colocataires.map{|c| c.nom.to_s} %>
<script type="text/javascript">
	$('#tweet').atwho({
		at: "@",
		data:<%= raw @colocataires.map{|c| c.nom}.to_json %>
	}).atwho({
	   at: "#",
		data:<%= raw @expenses.last(5).map{|e| e.raison}.to_json %>
	});
	
	$("#tweet").keyup(function() {
		var value = $("#tweet").val();
		var gotRoommate = extractFromRegexp(value, /(^|\W)(@[a-z\d][\w-]*)/ig, "roommates", true)
		var gotReason = extractFromRegexp(value, /(^|\W)(#[a-z\d][\w-]*)/i, "reason");
		var gotAmount = extractFromRegexp(value, /(^|\W)([a-z\d][\w-]*€)/i, "amount");
		
	});

	var extractFromRegexp = function(value, regexp, target, global) {
		global = global || false;
		var splitHash = value.match(regexp);
		if (splitHash != null) {
			if (global) {
				$("#"+target).text(splitHash);
			} else {
				$("#"+target).text(splitHash[2]);
			}
			return true;
		} else {
			return false;   
		}
	}
	
	$('#expenseForm').validator({
		custom: {
			roommates: function($el) { 
				var value = $("#tweet").val();
				return extractFromRegexp(value, /(^|\W)(@[a-z\d][\w-]*)/ig, "roommates", true);
			}, 
			reason: function($el) { 
				var value = $("#tweet").val();
				return extractFromRegexp(value, /(^|\W)(#[a-z\d][\w-]*)/i, "reason");
			} , 
			amount: function($el) { 
				var value = $("#tweet").val();
				return extractFromRegexp(value, /(^|\W)([a-z\d][\w-]*€)/i, "amount");
			} 
		},
		errors: {
			roommates: 'Mention your roommates using "@"',
			reason: 'Specify a reason with "#"',
			amount: 'Specify the expensewith "€"'
		}
	});

</script>
